# encoding: utf-8
# ------------ ç½‘æ˜“ ---------------
# ç½‘æ ¼nâœ–ï¸mï¼Œå°å¼ºä»èµ·ç‚¹èµ°åˆ°ç»ˆç‚¹ï¼Œæ¯ä¸€æ­¥å¯é€‰æ‹©å‘¨å›´8ä¸ªç‚¹
# ç½‘æ ¼å†…æœ‰å‘å°„å™¨ï¼Œå‘å‡ºçš„æ¿€å…‰ä¸ºæŸä¸€æ–¹å‘ç›´çº¿ï¼Œåˆ°ä¸‹ä¸€ä¸ªå‘å°„å™¨æˆ–éšœç¢ç‰©åœæ­¢
# ç½‘æ ¼å†…çš„éšœç¢ç‰©ä¸å¯é€šè¿‡
# è¦æ±‚æœ€ç»ˆçš„è·¯å¾„ä¸­ç›¸é‚»ä¸¤ä¸ªæ ¼å­æœ€å¤šæœ‰ä¸€ä¸ªæ ¼å­æœ‰æ¿€å…‰
# æ±‚è·¯å¾„æœ€å°‘æœ‰å‡ ä¸ªæ ¼å­æœ‰æ¿€å…‰ï¼Œè‹¥è·¯å¾„ä¸å­˜åœ¨è¿”å›-1
# è¾“å…¥
# 2           ä¸€å…±Tç»„æµ‹è¯•æ•°æ®ï¼ŒT = 2
# 3 3         ç¬¬ä¸€ç»„æµ‹è¯•ç”¨ä¾‹   ç½‘æ ¼å¤§å° n = 3; m = 3
# 1 1 3 3                    èµ·ç‚¹åæ ‡å’Œç»ˆç‚¹åæ ‡ x1 = 1ï¼›y1 = 1ï¼›x2 = 3ï¼›y2 = 3
# 2                          æœ‰kä¸ªéšœç¢ç‰©å’Œå‘å°„å™¨ k = 2
# 2 1 r                      å‘å°„å™¨åæ ‡ï¼Œæ–¹å‘å‘å³ï¼ˆuï¼šä¸Šï¼›dï¼šä¸‹ï¼›lï¼šå·¦ï¼‰
# 2 3 B                      éšœç¢ç‰©åæ ‡
# 3 2         ç¬¬äºŒç»„æµ‹è¯•ç”¨ä¾‹   ç½‘æ ¼å¤§å° n = 3; m = 2
# 1 2 3 1                    èµ·ç‚¹åæ ‡å’Œç»ˆç‚¹åæ ‡ x1 = 1ï¼›y1 = 2ï¼›x2 = 3ï¼›y2 = 1
# 2                          æœ‰kä¸ªéšœç¢ç‰©å’Œå‘å°„å™¨ k = 2
# 2 1 B                      ç¬¬ä¸€ä¸ªéšœç¢ç‰©åæ ‡
# 2 2 B                      ç¬¬äºŒä¸ªéšœç¢ç‰©åæ ‡
# è¾“å‡º
# 1           ç¬¬ä¸€ç»„æµ‹è¯•ç”¨ä¾‹   æœ‰ä¸€ä¸ªæ ¼å­æœ‰æ¿€å…‰
# -1          ç¬¬äºŒç»„æµ‹è¯•ç”¨ä¾‹   è·¯å¾„ä¸å­˜åœ¨
# --------- DFS  -------------------
# ç¦æ­¢ï¼šè¾¹ç•Œï¼›éšœç¢ç‰©ï¼›è¿ç»­ä¸¤ä¸ªæ¿€å…‰æ ¼å­
# ç»ˆæ­¢ï¼šç»ˆç‚¹ï¼›
# å‰ªæï¼šå½“å‰æ¿€å…‰æ ¼å­å¤šäºä¹‹å‰
import sys


def main():
    T = int(sys.stdin.readline().strip())  # T ç»„æµ‹è¯•
    res = [0] * T # æ¯ç»„æµ‹è¯•çš„ç»“æœ
    for i in range(T):
        tmp = list(map(int, sys.stdin.readline().strip().split(' ')))
        n, m = tmp[0], tmp[1]   # ç½‘æ ¼å¤§å°
        res[i] = n * m

        # net = [[1] * (m + 1)] * (n + 1)
        # æœ¬æ„æ˜¯æŠŠçŸ©é˜µçš„ç¬¬ä¸€è¡Œç¬¬äºŒåˆ—èµ‹å€¼ä¸º 2ï¼Œ ä½†æ˜¯æœ€ç»ˆç»“æœæ˜¯æ¯ä¸€è¡Œçš„ç¬¬äºŒåˆ—éƒ½æ˜¯ 2
        # ist * nâ€”>n shallow copies of list concatenated, nä¸ªlistçš„æµ…æ‹·è´çš„è¿æ¥
        # ä¿®æ”¹å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ ä¼šæ”¹å˜æ•´ä¸ªåˆ—è¡¨ï¼Œ
        net = [([0] * (m + 1)) for x in range(n + 1)]  # å˜é‡ i ä¸èƒ½é‡å¤
        # è¡Œæ•°ï¼šn + 1ï¼›åˆ—æ•°ï¼šm + 1ï¼Œæ˜¯ä¸ºäº†å’Œä¹‹åçš„æ ¼å­åæ ‡å¯¹åº”
        # åœ¨ç½‘æ ¼ä¸­å¯ä»¥é€šè¿‡ï¼š0ï¼Œæ¿€å…‰æ ¼å­ï¼š1ï¼›éšœç¢ç‰©ï¼š-1ï¼Œæ˜¯ä¸ºäº†è®°å½•è·¯å¾„ä¸­æ€»æ¿€å…‰æ ¼å­æ•°å¯ä»¥ç›´æ¥åŠ ä¸Šnetå€¼

        tmp = list(map(int, sys.stdin.readline().strip().split(' ')))
        x1, y1, x2, y2 = tmp[0], tmp[1], tmp[2], tmp[3]         # èµ·ç‚¹ï¼›ç»ˆç‚¹

        k = int(input())   # æ¿€å…‰+éšœç¢ç‰©æ•°é‡
        x = [0] * k  # æ¿€å…‰æ¨ªåæ ‡list
        y = [0] * k  # æ¿€å…‰çºµåæ ‡list
        laser = [0] * k  # æ¿€å…‰ç±»å‹

        # é¦–å…ˆåœ¨ç½‘æ ¼ä¸­è¡¨ç¤ºå‡ºéšœç¢ç‰© 0
        for j in range(k):
            tmp = sys.stdin.readline().strip().split(' ')
            if ord(tmp[2]) == 66:  # B: éšœç¢ç‰©
                net[int(tmp[0])][int(tmp[1])] = -1
            else:
                x[j], y[j], laser[j] = int(tmp[0]), int(tmp[1]), ord(tmp[2])

        # æ ¹æ®éšœç¢ç‰©å’Œè¾¹ç•Œï¼Œåœ¨ç½‘æ ¼ä¸­è¡¨ç¤ºå‡ºæ¿€å…‰æ ¼å­ -1
        j = 0
        while laser[j] and j < k:
            if laser[j] == 114:  # r: ğŸ‘‰
                r = 0
                while (y[j] + r) <= n and net[x[j]][y[j] + r] != -1:  # æ²¡æœ‰è¶Šç•Œå’Œéšœç¢ç‰©
                    net[x[j]][y[j] + r] = 1  # æ¿€å…‰æ ¼å­
                    r += 1
            elif laser[j] == 108:  # l: ğŸ‘ˆ
                r = 0
                while (y[j] - r) > 0 and net[x[j]][y[j] - r] != -1:  # æ²¡æœ‰è¶Šç•Œå’Œéšœç¢ç‰©
                    net[x[j]][y[j] - r] = 1  # æ¿€å…‰æ ¼å­
                    r += 1
            elif laser[j] == 117:  # u: ğŸ‘†
                r = 0
                while (x[j] - r) > 0 and net[x[j] - r][y[j]] != -1:  # æ²¡æœ‰è¶Šç•Œå’Œéšœç¢ç‰©
                    net[x[j] - r][y[j]] = 1  # æ¿€å…‰æ ¼å­
                    r += 1
            else:
                r = 0
                while (x[j] + r) <= m and net[x[j] + r][y[j]] != -1:  # æ²¡æœ‰è¶Šç•Œå’Œéšœç¢ç‰©
                    net[x[j] + r][y[j]] = 1  # æ¿€å…‰æ ¼å­
                    r += 1
            j += 1

        # ------------- DFS -------------
        stack = [(x1, y1),(0, 0)]  # æ²¿é€”æ ¼å­å‹æ ˆ
        direction = [(0, 1), (1, 0), (-1, 0), (0, -1)]
        path = []  # è¯¥è·¯å¾„ä¸å­˜åœ¨
        laser = 0  # è¯¥è·¯å¾„çš„æ¿€å…‰æ ¼å­æ•°é‡ï¼Œç”¨äºå‰ªæå’Œé€‰æ‹©æœ€ä¼˜ç­”æ¡ˆ
        while stack:
            stack.pop()  # ç¬¬ä¸€æ¬¡popæ˜¯(0, 0) è¡¨ç¤ºå½“å‰çš„å±‚æ¬¡
            if not stack:  # æ­¤æ—¶pathä¹Ÿä¸ºç©º
                break
            cur_x, cur_y = stack.pop()           # ç¬¬äºŒæ¬¡popæ˜¯æ­¤æ¬¡è¦èµ°çš„æ ¼å­
            stack.append((0, 0))                 # å°†(0, 0) åŠ ä¸Šï¼Œä½¿å¾—å®é™…ä¸Šæ¯æ¬¡åªpopäº†ç¬¬äºŒæ¬¡çš„å€¼
            if cur_x:                            # æ­¤æ¬¡è¦èµ°çš„æ ¼å­æ˜¯æœ‰å®é™…ä½ç½®çš„
                laser += net[cur_x][cur_y]       # å‡è®¾èµ°è¿™ä¸ªæ ¼å­ï¼Œé¦–å…ˆåŠ ä¸Šè¿™ä¸ªæ ¼å­çš„netå€¼
                if laser <= res[i]:              # å‡è®¾æˆç«‹
                    path.append((cur_x, cur_y))  # å°†æ ¼å­åŠ å…¥path
                    for j in direction:          # å¯»æ‰¾è¿™ä¸ªæ ¼å­çš„ä¸‹ä¸€ä¸ªåˆç†çš„æ ¼å­
                        if 0 < cur_x + j[0] <= n and 0 < cur_y + j[1] <= m \
                                and net[cur_x + j[0]][cur_y + j[1]] != -1 \
                                and net[cur_x][cur_y] + net[cur_x + j[0]][cur_y + j[1]] < 2 \
                                and (cur_x + j[0], cur_y + j[1]) not in path:  # # è¾¹ç•Œ, éšœç¢ç‰©,ç›¸é‚»ä¸¤ä¸ªæ ¼å­æœ€å¤šæœ‰ä¸€ä¸ªæ ¼å­æœ‰æ¿€å…‰
                            if cur_x + j[0] == x2 and cur_y + j[1] == y2:  # ç»ˆç‚¹ä¸å…¥æ ˆ
                                laser += net[cur_x + j[0]][cur_y + j[1]]   # ç¡®å®šæ•´ä¸ªè·¯å¾„çš„æ¿€å…‰æ ¼å­æ•°é‡
                                if res[i] > laser:                         # å’Œä¹‹å‰çš„æœ€ä¼˜å€¼æ¯”è¾ƒ
                                    res[i] = laser                         # æ›´æ–°
                            else:                                          # ä¸æ˜¯ç»ˆç‚¹
                                stack.append((cur_x + j[0], cur_y + j[1])) # å…¥æ ˆ
                    stack.append((0, 0))      # æ¯ä¸€è½®ç¡®å®šåç»­æ ¼å­åï¼Œéƒ½åŠ å…¥(0, 0)è¡¨ç¤ºä¸€ä¸ªå±‚çº§
                else:                         # éœ€è¦å‰ªæï¼Œå°†laserå¤åŸ
                    laser -= net[cur_x][cur_y]
            else:                             # ä¸¤æ¬¡popéƒ½æ˜¯0ï¼Œè¯´æ˜pathéœ€è¦å›æº¯ä¸€ä¸ªå±‚çº§
                tmp = path.pop()
                laser -= net[tmp[0]][tmp[1]]  # laserä¸pathä¿æŒä¸€è‡´
        if res[i] == m*n:  # res[i]ä»æœªåšæ›´æ–°ï¼Œè¯´æ˜éå†å®Œå…¨ä¹Ÿæ²¡æœ‰æ‰¾åˆ°è·¯å¾„
            res[i] = -1    # è·¯å¾„ä¸å­˜åœ¨ï¼Œè¿”å›-1
    for i in range(T):     # è¿”å›æ¯ä¸€ç»„æµ‹è¯•çš„ç»“æœ
        print (res[i])


main()
