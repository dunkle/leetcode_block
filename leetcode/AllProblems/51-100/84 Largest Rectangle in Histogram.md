给定一个柱状图，求出柱状图中最大的矩形面积。

![image-20201007140528032](../../../.assert/image-20201007140528032.png)

对于柱状图中的每一个区间来说，依据短板效应，该柱所构成的最大的矩形的高为当前矩形的高，边长为分别向左向右找第一个比当前节点低的区间。

那么暴力的想法是，对于每一个区间，分别向左向右找比当前小的区间，计算矩形面积。

本题可以用单调递增栈进行优化。回忆单调递增栈的使用：

遍历数组：

- 如果当前值比栈顶元素大，则将值入栈，

- 如果当前值比栈顶元素小，则栈顶元素出栈，直到栈顶元素比当前值小。

由此可得到单调栈的一个性质是，单调栈中栈顶元素左边的元素是栈顶元素左边第一个比栈顶元素小的元素，而在遍历过程中如果要出栈说明当前元素是右边第一个比栈顶元素小的元素。

利用单调栈，本题的解法变为：

利用一个单调栈，记录每个区间的坐标。在出栈时，单调栈第二个元素保存了栈顶左边第一个比当前值小的元素，当前元素为右遍第一个比栈顶元素小的元素，利用位置计算宽，高为栈顶元素的大小。

~~~python
class Solution:
    def largestRectangleArea(self, heights: List[int]) -> int:
        stack = [-1]
        heights.append(0)
        ans = 0
        for i in range(len(heights)):
            while heights[i] < heights[stack[-1]]:
                h = heights[stack.pop()]
                w = i-stack[-1]-1
                ans = max(ans, h*w)
            stack.append(i)
        heights.pop()
        return ans
                
~~~

